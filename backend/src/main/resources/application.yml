server:
  compression:
    enabled: true
    mime-types: application/json,text/html,text/css,application/javascript
    min-response-size: 1024
  tomcat:
    threads:
      max: 50            # B2 has 2 vCPU — keep modest; default 200 wastes memory
      min-spare: 10
    connection-timeout: 10000   # 10s — fail fast on slow clients
  servlet:
    session:
      timeout: ${SESSION_TIMEOUT:20m}   # configurable via env; default 20 minutes of inactivity
      cookie:
        same-site: lax    # same origin via Front Door — lax is sufficient
        secure: true       # Front Door uses HTTPS
        max-age: 86400     # 24h — keeps cookie alive across mobile browser restarts / app switches;
                           #        actual session lifetime is enforced server-side by timeout above

spring:
  servlet:
    multipart:
      max-file-size: 20MB
      max-request-size: 20MB
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    hikari:
      initialization-fail-timeout: -1
      maximum-pool-size: 20      # was 10 — B2 with 50 Tomcat threads needs headroom
      minimum-idle: 4            # was 2 — keep a few warm connections ready
      idle-timeout: 300000
      connection-timeout: 10000  # was 60000 — fail fast instead of holding request thread for 60s
      max-lifetime: 1800000      # 30 min — recycle before Azure SQL idle-kill
  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.dialect.SQLServerDialect
  jooq:
    sql-dialect: SQLSERVER2016   # or a suitable version

# src/main/resources/application.yml (add under spring:)
uploads:
  dir: uploads   # local folder for profile images (maps to /uploads); change to your mount path later
app:
  cors:
    origin: ${APP_CORS_ORIGIN:http://localhost:3000}

azure:
  storage:
    connection-string: ${AZURE_STORAGE_CONNECTION_STRING}
    container-name: ${AZURE_STORAGE_CONTAINER_NAME}
cdn:
  base-url: ${CDN_BASE_URL:}
  container-name: ${CDN_CONTAINER_NAME}
  cache-control: public, max-age=86400


# Notes:
  # - Protect your origin (Blob) so only the CDN can read from it.
  # - The CDN URL is constructed as {cdn.base-url}/{key}.
  # - For immutable static assets, prefer hashed filenames and immutable cache headers.
  # - For user images that change, write new files (new keys) rather than overwriting, then update DB to the new URL.
twilio:
  account-sid: ${TWILIO_ACCOUNT_SID:}
  auth-token: ${TWILIO_AUTH_TOKEN:}
  from-number: ${TWILIO_FROM_NUMBER:}

notification:
  prompt-cooldown-days: ${NOTIFICATION_PROMPT_COOLDOWN_DAYS:30}

app-config:
  base-url: ${APP_BASE_URL:http://localhost:3000}
